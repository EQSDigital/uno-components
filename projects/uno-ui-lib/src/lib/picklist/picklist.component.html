<!-- picklist HTML is a <span unoDropdown /> markup, with specific TS behaviors - like multiple selection, items list online filtering, etc. -->
<span
    [ngClass]="{ 'slds-picklist--fluid': fluid }"
    unoDropdown
    [open]="open"
    [unoDropdownHandlePageEvents]="closeClickOutside"

    (openChange)="openChange.emit($event)"
    (selectedElem)="onSelectedElem($event)">
    
    <!-- the Dropdown trigger: -->
    <button
        type="button"
        unoDropdownTrigger
        class="slds-button--neutral slds-uno-picklist--label slds-truncate slds-align--absolute-center"
        style="padding: 0 10px"
        [class.slds-input]="!isForInlineTableCSS"
        [class.slds-button]="isForInlineTableCSS"
        [disabled]="isDisabled">
            <ng-content></ng-content>
            <uno-icon icon="down_s" size="xx-small" class="slds-m-left_small slds-float--right"></uno-icon>
    </button>

    <!-- the Dropdown list of items -->
    <div class="slds-dropdown slds-dropdown--left" [ngClass]="{ 'slds-p-top--none': hasFilter, 'slds-dropdown--open-up': isToOpenUp, 'positionInherit': position }">

        <!-- filtering user input box possibility-->
        <input 
            *ngIf="hasFilter"
            class="slds-input"
            #filterInput
            [attr.placeholder]="filterPlaceholder"
            [ngModel]="userFilter"
            (ngModelChange)="filterChange($event)"

            (keydown.enter)="onFilterPick()"
            (keydown.arrowdown)="setFilterActive(1, $event)"
            (keydown.arrowup)="setFilterActive(-1, $event)"
            (focus)="onFilterFocus()"
            (blur)="onFilterBlur()" >

        <!-- the Dropdown list of items -->
        <ul class="dropdown__list" [ngClass]="dropdownListClass" role="menu"
            unoScrollTracker
            (scrollEndReached)="scrollEndReached.emit($event)">

            <!-- Insert blank element, to reset piked item ? -->
            <li *ngIf="insertBlankElement && !pick.isMultiple" class="slds-dropdown__item unselect-item"
                uno-pick-option
                [unoPickOption]="''"
                (mouseover)="onOptionHover(-1)">

                <a unoDropdownItem role="menuitem" translate>-- (select none) --</a>
            </li>
            <!-- Cycle of all [filteredData] elements: -->
            <li *ngFor="let item of filteredData; let i = index;" class="slds-dropdown__item"
                uno-pick-option
                [unoPickOption]="item"
                [class.slds-is-active]="isOptionActive(item)"
                (mouseover)="onOptionHover(i)">

                <span unoDropdownItem role="menuitem" class="picklist-box picklist-border">
                    <p class="slds-truncate" style="display: contents;">
                        <input *ngIf="showCheckBox" type="checkbox" [checked]="isOptionActive(item)">
                        <span class="picklist-text slds-truncate">
                            <ng-template [ngTemplateOutlet]="itemTemplate?.templateRef" [ngTemplateOutletContext]="{$implicit: item}"></ng-template>    
                        </span>
                    </p>
                </span>
            </li>
            <li *ngIf="insertCreateButton" class="slds-dropdown__item"
                uno-pick-option
                [unoPickOption]="'addButton'"
                (mouseover)="onOptionHover(0)">

                <a unoDropdownItem role="menuitem" class="slds-p-around--small" style="cursor: pointer; display: block; border-top: solid 1px #9e9e9e45">
                    <uno-icon size="x-small" icon="plus" style="padding-right: 10px"></uno-icon>
                    {{ addButton }}
                </a>
            </li>
        </ul>
    </div>
</span>